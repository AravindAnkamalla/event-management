generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model events {
  id               Int             @id @default(autoincrement())
  name             String
  description      String?
  eventDate        DateTime        @db.Date
  startTime        DateTime        @db.Time(6)
  endTime          DateTime        @db.Time(6)
  address          String
  eventType        String
  eventStatus      EventStatus     @default(ACTIVE)
  organizerName    String
  organizerContact String
  imageUrl         String?
  registrations    registrations[]
}

model otps {
  id        Int      @id @default(autoincrement())
  email     String
  code      String   @db.VarChar(6)
  expiresAt DateTime
  verified  Boolean  @default(false)
  createdAt DateTime @default(now())

  @@index([email])
}

model registrations {
  id               Int                 @id @default(autoincrement())
  userId           Int
  eventId          Int
  registrationDate DateTime            @default(now()) @db.Date
  status           RegistrationStatus?
  events           events              @relation(fields: [eventId], references: [id], onDelete: Cascade)
  users            users               @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, eventId])
}

model users {
  id            Int              @id @default(autoincrement())
  username      String           @unique
  password      String           @db.VarChar(64)
  email         String           @unique
  mobile        String?
  role          Role             @default(USER)
  createdAt     DateTime         @default(now())
  createdBy     Role             @default(ADMIN)
  invitation    InvitationStatus @default(READY)
  isFirstLogin  Boolean          @default(true)
  updatedAt     DateTime         @default(now())
  updatedBy     Role             @default(ADMIN)
  registrations registrations[]
}

enum EventStatus {
  ACTIVE
  COMPLETED
  CANCELLED
}

enum InvitationStatus {
  READY
  SENT
}

enum RegistrationStatus {
  REGISTERED
  CANCELLED
}

enum Role {
  ADMIN
  USER
}
